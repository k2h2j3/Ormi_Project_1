<!DOCTYPE html>
<html>
  <head>
    <title>영화 추천</title>
    <!-- jQuery -->
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- CSS 파일 연결 -->
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="wrap">
      <section>
        <!-- Head -->
        <div id="title">
          <h1><p>Movie Tracker</p></h1>
        </div>
        <!-- main -->
        <div id="main">
          <!-- 챗봇이 답변해주는 칸 -->
          <div id="contents">
            <div id="loader"></div>
          </div>
          <!-- question -->
          <div id="question">
            <div id="title-question">당신의 영화 취향은?</div>
            <form id="text-form">
              <!-- 년도 입력칸 -->
              <div id="when">
                <label for="text1-input"></label>
                <input
                  type="text"
                  id="year"
                  name="year-input"
                  placeholder="년도를 입력하세요"
                />
              </div>
              <!-- 장르 입력칸 -->
              <div id="typee">
                <label for="text2-input"></label>
                <input
                  type="text"
                  id="genre"
                  name="genre-input"
                  placeholder="장르를 입력하세요"
                />
              </div>
              <!-- 국내 해외 선택 칸 -->
              <div id="countri">
                <label for="text3-input"></label>
                <select id="country" name="country-input">
                  <option value="">선택</option>
                  <option value="한국">국내</option>
                  <option value="해외">해외</option>
                </select>
              </div>
              <!-- 검색 버튼 칸 -->
              <div id="search">
                <button id="button" type="submit">영화 검색</button>
              </div>
            </form>
            <!-- 로딩 창 -->
            <div id="roading"></div>
          </div>

          <!-- 최신 영화 -->
          <div id="latest">
            <div id="latestmovie-title">
              <div id="latestmovie-title-name">이달의 영화</div>
            </div>
            <div id="movie1-box">
              <button class="btn-open-popup" id="btn-latest-movie1">
                <img
                  id="movie1-poster"
                  src="movieimg/movie1.png"
                  href="#myModal1"
                />
              </button>
            </div>
            <div id="movie2-box">
              <button class="btn-open-popup" id="btn-latest-movie2">
                <img
                  id="movie2-poster"
                  src="movieimg/movie2.png"
                  href="#myModal2"
                />
              </button>
            </div>
            <div id="movie3-box">
              <button class="btn-open-popup" id="btn-latest-movie3">
                <img
                  id="movie3-poster"
                  src="movieimg/movie3.png"
                  href="#myModal3"
                />
              </button>
            </div>
            <div id="movie4-box">
              <button class="btn-open-popup" id="btn-latest-movie4">
                <img
                  id="movie4-poster"
                  src="movieimg/movie4.png"
                  href="#myModal4"
                />
              </button>
            </div>
          </div>

          <!-- 베스트 영화 -->
          <div id="best-movie">
            <div id="bestmovie-title">
              <div id="bestmovie-title-name">베스트 영화</div>
            </div>
            <div id="movie1-box">
              <button class="btn-open-popup" id="btn-latest-movie5">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie1.png"
                  href="#myModal5"
                />
              </button>
            </div>
            <div id="movie2-box">
              <button class="btn-open-popup" id="btn-latest-movie6">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie2.png"
                  href="#myModal6"
                />
              </button>
            </div>
            <div id="movie3-box">
              <button class="btn-open-popup" id="btn-latest-movie7">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie3.png"
                  href="#myModal7"
                />
              </button>
            </div>
            <div id="movie4-box">
              <button class="btn-open-popup" id="btn-latest-movie8">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie4.png"
                  href="#myModal8"
                />
              </button>
            </div>
          </div>
        </div>
      </section>
      <!-- footer -->
      <footer>
        <nav>
          <a href="https://github.com/k2h2j3">Github</a>
        </nav>
        <p>
          <span>대표자 : 김승겸</span><br />
          <span>이메일 : k2h2j3@gmail.com</span><br />
          <span>MovieTracker 2023. Published</span>
        </p>
      </footer>
      <!-- modal -->
      <!-- Trigger/Open The Modal -->
      <!-- The Modal -->
      <div id="myModal1" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...1</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
      <!-- The Modal -->
      <div id="myModal2" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...2</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
      <!-- The Modal -->
      <div id="myModal3" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...3</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
      <!-- The Modal -->
      <div id="myModal4" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...4</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
      <div id="myModal5" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...5</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
      <div id="myModal6" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...6</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
      <div id="myModal7" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...7</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
      <div id="myModal8" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>Modal Header</h2>
          </div>
          <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...8</p>
          </div>
          <div class="modal-footer">
            <h3>Modal Footer</h3>
          </div>
        </div>
      </div>
    </div>
    <!-- JavaScript 파일 연결 -->
    <script>
      // 로딩버튼 처음에 가리기
      $("#loader").hide();
      // 모달
      var btn = document.querySelectorAll("button.btn-open-popup");
      console.log(btn);
      var modals = document.querySelectorAll(".modal-custom");
      console.log(modals);
      var spans = document.getElementsByClassName("close-modal");
      console.log(spans);

      for (var i = 0; i < btn.length; i++) {
        btn[i].onclick = function (e) {
          e.preventDefault();
          modal = document.querySelector(e.target.getAttribute("href"));
          console.log(modal);
          modal.style.display = "block";
        };

        spans[i].onclick = function () {
          for (var index in modals) {
            if (typeof modals[index].style !== "undefined")
              modals[index].style.display = "none";
          }
        };
      }

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target.classList.contains("modal-custom")) {
          for (var index in modals) {
            if (typeof modals[index].style !== "undefined")
              modals[index].style.display = "none";
          }
        }
      };

      // dd
      // function show() {
      //   document.querySelector(".background").className = "background show";
      // }

      // function close() {
      //   document.querySelector(".background").className = "background";
      // }

      // document.querySelector(".btn-open-popup").addEventListener("click", show);
      // document.querySelector("#close").addEventListener("click", close);

      let $button = document.querySelector("button");

      function combineText() {
        let qeustion;

        let year = document.getElementById("year").value;
        let genre = document.getElementById("genre").value;
        let country = document.querySelector("select").value;

        question =
          year +
          "년도의 장르가 " +
          genre +
          "인 " +
          country +
          "영화를 추천해 줘";

        return question;
      }

      let data = [
        {
          role: "system",
          content: "assistant는 영화 전문가이다.",
        },
      ];

      let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;

      $button.addEventListener("click", (e) => {
        $("#loader").show();
        e.preventDefault();
        userInputData = "";
        var quest = combineText();
        userInputData = quest;
        console.log(userInputData);
        quest = "";

        data.push({
          role: "user",
          content: userInputData,
        });

        chatGptAPI();
      });

      function chatGptAPI() {
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
          redirect: "follow",
        })
          .then((res) => res.json())
          .then((res) => {
            // console.log(res)
            // console.log(res.choices[0].message.content)
            document.querySelector("#contents").innerText =
              res.choices[0].message.content;
          });
      }
    </script>
  </body>
</html>
