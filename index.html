<!DOCTYPE html>
<html>
  <head>
    <title>영화 추천</title>
    <!-- CSS 파일 연결 -->
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <!-- Head -->
    <div id="title">
      <h1><p>Movie Tracker</p></h1>
    </div>
    <!-- main -->
    <div id="main">
      <!-- 챗봇이 답변해주는 칸 -->
      <div id="contents"></div>
      <div id="latest">이달의 영화</div>
      <!-- question -->
      <div id="question">
        <div id="title-question">당신의 영화 취향은?</div>
        <form id="text-form">
          <!-- 년도 입력칸 -->
          <div id="when">
            <label for="text1-input"></label>
            <input
              type="text"
              id="year"
              name="year-input"
              placeholder="년도를 입력하세요"
            />
          </div>
          <!-- 장르 입력칸 -->
          <div id="typee">
            <label for="text2-input"></label>
            <input
              type="text"
              id="genre"
              name="genre-input"
              placeholder="장르를 입력하세요"
            />
          </div>
          <!-- 국내 해외 선택 칸 -->
          <div id="countri">
            <label for="text3-input"></label>
            <select id="country" name="country-input">
              <option value="">선택</option>
              <option value="한국">국내</option>
              <option value="해외">해외</option>
            </select>
          </div>
          <!-- 검색 버튼 칸 -->
          <div id="search">
            <button id="button" type="submit">영화 검색</button>
          </div>
        </form>
        <!-- 로딩 창 -->
        <div id="roading"></div>
      </div>
    </div>

    <!-- JavaScript 파일 연결 -->
    <script>
      let $button = document.querySelector("button");

      function combineText() {
        let qeustion;

        let year = document.getElementById("year").value;
        let genre = document.getElementById("genre").value;
        let country = document.querySelector("select").value;

        question =
          year +
          "년도의 장르가 " +
          genre +
          "인 " +
          country +
          "영화를 추천해 줘";

        return question;
      }

      let data = [
        {
          role: "system",
          content: "assistant는 영화 전문가이다.",
        },
      ];

      let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;

      $button.addEventListener("click", (e) => {
        e.preventDefault();
        userInputData = "";
        var quest = combineText();
        userInputData = quest;
        console.log(userInputData);
        quest = "";

        data.push({
          role: "user",
          content: userInputData,
        });

        chatGptAPI();
      });

      function chatGptAPI() {
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
          redirect: "follow",
        })
          .then((res) => res.json())
          .then((res) => {
            // console.log(res)
            // console.log(res.choices[0].message.content)
            document.querySelector("#contents").innerText =
              res.choices[0].message.content;
          });
        // 아래 코드는 fetch 성공, 실패, 통신 중 여부와 상관없이 실행됩니다. 비동기에요.
        console.log("hello world");
      }
    </script>
  </body>
</html>
