<!DOCTYPE html>
<html>
  <head>
    <title>영화 추천</title>
    <!-- jQuery -->
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- CSS 파일 연결 -->
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="wrap">
      <section>
        <!-- Head -->
        <div id="title">
          <h1><p>Movie Tracker</p></h1>
        </div>
        <!-- main -->
        <div id="main">
          <!-- 챗봇이 답변해주는 칸 -->
          <div id="contents">
            <div id="loader"></div>
          </div>
          <!-- question -->
          <div id="question">
            <div id="title-question">당신의 영화 취향은?</div>
            <form id="text-form">
              <!-- 년도 입력칸 -->
              <div id="when">
                <label for="text1-input"></label>
                <input
                  type="text"
                  id="year"
                  name="year-input"
                  placeholder="년도를 입력하세요"
                />
              </div>
              <!-- 장르 입력칸 -->
              <div id="typee">
                <label for="text2-input"></label>
                <input
                  type="text"
                  id="genre"
                  name="genre-input"
                  placeholder="장르를 입력하세요"
                />
              </div>
              <!-- 국내 해외 선택 칸 -->
              <div id="countri">
                <label for="text3-input"></label>
                <select id="country" name="country-input">
                  <option value="">선택</option>
                  <option value="한국">국내</option>
                  <option value="해외">해외</option>
                </select>
              </div>
              <!-- 검색 버튼 칸 -->
              <div id="search">
                <button id="button" type="submit">영화 검색</button>
              </div>
            </form>
            <!-- 로딩 창 -->
            <div id="roading"></div>
          </div>

          <!-- 최신 영화 -->
          <div id="latest">
            <div id="latestmovie-title">
              <div id="latestmovie-title-name">이달의 영화</div>
            </div>
            <div id="movie1-box">
              <button class="btn-open-popup" id="btn-latest-movie1">
                <img
                  id="movie1-poster"
                  src="movieimg/movie1.png"
                  href="#myModal1"
                />
              </button>
            </div>
            <div id="movie2-box">
              <button class="btn-open-popup" id="btn-latest-movie2">
                <img
                  id="movie2-poster"
                  src="movieimg/movie2.png"
                  href="#myModal2"
                />
              </button>
            </div>
            <div id="movie3-box">
              <button class="btn-open-popup" id="btn-latest-movie3">
                <img
                  id="movie3-poster"
                  src="movieimg/movie3.png"
                  href="#myModal3"
                />
              </button>
            </div>
            <div id="movie4-box">
              <button class="btn-open-popup" id="btn-latest-movie4">
                <img
                  id="movie4-poster"
                  src="movieimg/movie4.png"
                  href="#myModal4"
                />
              </button>
            </div>
          </div>

          <!-- 베스트 영화 -->
          <div id="best-movie">
            <div id="bestmovie-title">
              <div id="bestmovie-title-name">베스트 영화</div>
            </div>
            <div id="movie1-box">
              <button class="btn-open-popup" id="btn-latest-movie5">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie1.png"
                  href="#myModal5"
                />
              </button>
            </div>
            <div id="movie2-box">
              <button class="btn-open-popup" id="btn-latest-movie6">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie2.png"
                  href="#myModal6"
                />
              </button>
            </div>
            <div id="movie3-box">
              <button class="btn-open-popup" id="btn-latest-movie7">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie3.png"
                  href="#myModal7"
                />
              </button>
            </div>
            <div id="movie4-box">
              <button class="btn-open-popup" id="btn-latest-movie8">
                <img
                  id="movie1-poster"
                  src="movieimg/bestmovie4.png"
                  href="#myModal8"
                />
              </button>
            </div>
          </div>
        </div>
      </section>
      <!-- footer -->
      <footer>
        <nav>
          <a href="https://github.com/k2h2j3">Github</a>
        </nav>
        <p>
          <span>대표자 : 김승겸</span><br />
          <span>이메일 : k2h2j3@gmail.com</span><br />
          <span>MovieTracker 2023. Published</span>
        </p>
      </footer>
      <!-- modal -->
      <!-- Trigger/Open The Modal -->
      <!-- The Modal -->
      <div id="myModal1" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>범죄도시3</h2>
          </div>
          <div class="modal-body">
            대체불가 괴물형사 마석도, 서울 광수대로 발탁! 베트남 납치 살해범
            검거 후 7년 뒤, ‘마석도’(마동석)는 새로운 팀원들과 함께 살인사건을
            조사한다. 사건 조사 중, ‘마석도’는 신종 마약 사건이 연루되었음을
            알게 되고 수사를 확대한다. 한편, 마약 사건의 배후인
            '주성철'(이준혁)은 계속해서 판을 키워가고 약을 유통하던 일본 조직과
            '리키'(아오키 무네타카)까지 한국에 들어오며 사건의 규모는 점점 더
            커져가는데... 나쁜 놈들 잡는 데 이유 없고 제한 없다. 커진 판도
            시원하게 싹 쓸어버린다!
          </div>
          <div class="modal-footer">
            <h3>
              출연진: 마동석, 이준혁, 아오키 무네타카, 이범수, 김민재, 이지훈
            </h3>
          </div>
        </div>
      </div>
      <!-- The Modal -->
      <div id="myModal2" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>분노의 질주10</h2>
          </div>
          <div class="modal-body">
            돔(빈 디젤)과 그의 패밀리 앞에 나타난 운명의 적 단테(제이슨 모모아).
            과거의 그림자는 돔의 모든 것을 파괴하기 위해 달려온다. 단테에 의해
            산산히 흩어진 패밀리들은 모두 목숨을 걸고 맞서야 하는 함정에 빠지고
            마는데.. 달리거나 죽거나, 그들의 마지막 질주가 시작된다!
          </div>
          <div class="modal-footer">
            <h3>
              출연진: 반 디젤, 제이슨 모모아, 제이슨 스타뎀, 샤를리즈 테론, 브리
              라슨
            </h3>
          </div>
        </div>
      </div>
      <!-- The Modal -->
      <div id="myModal3" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>가디언즈 오브 갤럭시 vol.3</h2>
          </div>
          <div class="modal-body">
            ‘가모라’를 잃고 슬픔에 빠져 있던 ‘피터 퀼’이 위기에 처한 은하계와
            동료를 지키기 위해 다시 한번 가디언즈 팀과 힘을 모으고, 성공하지
            못할 경우 그들의 마지막이 될지도 모르는 미션에 나서는 이야기
          </div>
          <div class="modal-footer">
            <h3>
              출연진: 크리스 프랫, 조 샐다나, 데이브 바티스타, 반 디젤, 브래들리
              쿠퍼
            </h3>
          </div>
        </div>
      </div>
      <!-- The Modal -->
      <div id="myModal4" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>슈퍼 마리오 브라더스</h2>
          </div>
          <div class="modal-body">
            따단-딴-따단-딴 전 세계를 열광시킬 올 타임 슈퍼 어드벤처의 등장!
            뉴욕의 평범한 배관공 형제 '마리오'와 ‘루이지’는 배수관 고장으로
            위기에 빠진 도시를 구하려다 미스터리한 초록색 파이프 안으로 빨려
            들어가게 된다. 파이프를 통해 새로운 세상으로 차원 이동하게 된 형제.
            형 '마리오'는 뛰어난 리더십을 지닌 '피치'가 통치하는 버섯왕국에
            도착하지만 동생 '루이지'는 빌런 '쿠파'가 있는 다크랜드로 떨어지며
            납치를 당하고 ‘마리오’는 동생을 구하기 위해 ‘피치’와 ‘키노피오’의
            도움을 받아 '쿠파'에 맞서기로 결심한다. 그러나 슈퍼스타로 세상을
            지배하려는 그의 강력한 힘 앞에 이들은 예기치 못한 위험에 빠지게
            되는데...! 동생을 구하기 위해! 세상을 지키기 위해! '슈퍼 마리오'로
            레벨업 하기 위한 '마리오'의 스펙터클한 스테이지가 시작된다!
          </div>
          <div class="modal-footer">
            <h3>
              크리스 프랫, 안야 테일러 조이, 잭 블랙, 세스 로건, 찰리 데이
            </h3>
          </div>
        </div>
      </div>
      <div id="myModal5" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>다크나이트</h2>
          </div>
          <div class="modal-body">
            각종 범죄가 난무하는 고담시를 지키는 배트맨, 어느 날 도시에 광기
            어린 악당 조커가 등장해 사람들을 두려움에 빠뜨린다. 조커는 배트맨이
            정체를 밝힐 때까지 사람들을 죽이겠다고 협박하고, 배트맨은 자신의
            모든 것을 걸고 최악의 악당 조커와 맞서기 시작한다.
          </div>
          <div class="modal-footer">
            <h3>출연진: 크리스찬 베일, 히스 레저, 게리 올드먼, 에런 엑하트</h3>
          </div>
        </div>
      </div>
      <div id="myModal6" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>인터스텔라</h2>
          </div>
          <div class="modal-body">
            세계의 경제 및 정부가 완전히 붕괴되고, 과거의 잘못으로 인해 인류에게
            최악의 미래가 다가온다. 광활한 우주로 떠나 인간이 살 수 있는 행성을
            찾으러 나선 우주인들의 감동적이고 위대한 여정이 시작된다.
          </div>
          <div class="modal-footer">
            <h3>매슈 데이비드 메코너헤이, 제시카 채스테인, 앤 해서웨이</h3>
          </div>
        </div>
      </div>
      <div id="myModal7" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>기생충</h2>
          </div>
          <div class="modal-body">
            직업도 없이 허름한 반지하에 사는 기택 가족에게 돈을 벌 기회가
            찾아온다. 친구의 소개로 부잣집 딸 다혜의 과외 선생님을 맡게 된
            기택의 아들, 기우는 기대감에 부푼 채 글로벌 IT기업을 이끄는 박
            사장의 저택에 들어간다. 극과 극의 삶을 사는 두 가족의 예측 불가능한
            만남이 시작된다.
          </div>
          <div class="modal-footer">
            <h3>
              출연진: 송강호, 조여정, 최우식, 박서준, 박소담, 정지소, 이선균
            </h3>
          </div>
        </div>
      </div>
      <div id="myModal8" class="modal-custom">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="modal-header">
            <span class="close-modal">×</span>
            <h2>라라랜드</h2>
          </div>
          <div class="modal-body">
            헐리우드 배우지망생 미아와 재즈바를 차리는게 꿈인 피아노 연주자
            세바스찬은 우연히 만나 서로의 꿈을 응원하는 연인 사이가 된다.
            세바스찬은 오디션 낙방에 아쉬워하는 미아를 격려하고, 돈을 벌기 위해
            공연 투어에 나서지만 미아는 재즈바라는 꿈을 본격적으로 쫓지 않는
            그가 탐탁지 않다. 한편, 미아에게도 좋은 기회가 찾아오고 둘의 관계는
            새로운 단계를 맞이한다.
          </div>
          <div class="modal-footer">
            <h3>
              출연진: 엠마 스톤, 라이언 고슬링, J.K 시몬스빌, 존 레전드 키스
            </h3>
          </div>
        </div>
      </div>
    </div>
    <!-- JavaScript 파일 연결 -->
    <script>
      // 로딩버튼 처음에 가리기
      $("#loader").hide();
      // 모달
      var btn = document.querySelectorAll("button.btn-open-popup");
      console.log(btn);
      var modals = document.querySelectorAll(".modal-custom");
      console.log(modals);
      var spans = document.getElementsByClassName("close-modal");
      console.log(spans);

      for (var i = 0; i < btn.length; i++) {
        btn[i].onclick = function (e) {
          e.preventDefault();
          modal = document.querySelector(e.target.getAttribute("href"));
          console.log(modal);
          modal.style.display = "block";
        };

        spans[i].onclick = function () {
          for (var index in modals) {
            if (typeof modals[index].style !== "undefined")
              modals[index].style.display = "none";
          }
        };
      }

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target.classList.contains("modal-custom")) {
          for (var index in modals) {
            if (typeof modals[index].style !== "undefined")
              modals[index].style.display = "none";
          }
        }
      };

      // dd
      // function show() {
      //   document.querySelector(".background").className = "background show";
      // }

      // function close() {
      //   document.querySelector(".background").className = "background";
      // }

      // document.querySelector(".btn-open-popup").addEventListener("click", show);
      // document.querySelector("#close").addEventListener("click", close);

      let $button = document.querySelector("button");

      function combineText() {
        let qeustion;

        let year = document.getElementById("year").value;
        let genre = document.getElementById("genre").value;
        let country = document.querySelector("select").value;

        question =
          year +
          "년도의 장르가 " +
          genre +
          "인 " +
          country +
          "영화를 추천해 줘";

        return question;
      }

      let data = [
        {
          role: "system",
          content: "assistant는 영화 전문가이다.",
        },
      ];

      let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;

      $button.addEventListener("click", (e) => {
        $("#loader").show();
        e.preventDefault();
        userInputData = "";
        var quest = combineText();
        userInputData = quest;
        console.log(userInputData);
        quest = "";

        data.push({
          role: "user",
          content: userInputData,
        });

        chatGptAPI();
      });

      function chatGptAPI() {
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
          redirect: "follow",
        })
          .then((res) => res.json())
          .then((res) => {
            // console.log(res)
            // console.log(res.choices[0].message.content)
            document.querySelector("#contents").innerText =
              res.choices[0].message.content;
          });
      }
    </script>
  </body>
</html>
