<!DOCTYPE html>
<html>
  <head>
    <title>영화 추천</title>
    <!-- jQuery -->
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- CSS 파일 연결 -->
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="wrap">
      <!-- Head -->
      <div id="title">
        <h1><p>Movie Tracker</p></h1>
      </div>
      <!-- main -->
      <div id="main">
        <!-- 챗봇이 답변해주는 칸 -->
        <div id="contents">
          <div id="loader"></div>
        </div>
        <!-- question -->
        <div id="question">
          <div id="title-question">당신의 영화 취향은?</div>
          <form id="text-form">
            <!-- 년도 입력칸 -->
            <div id="when">
              <label for="text1-input"></label>
              <input
                type="text"
                id="year"
                name="year-input"
                placeholder="년도를 입력하세요"
              />
            </div>
            <!-- 장르 입력칸 -->
            <div id="typee">
              <label for="text2-input"></label>
              <input
                type="text"
                id="genre"
                name="genre-input"
                placeholder="장르를 입력하세요"
              />
            </div>
            <!-- 국내 해외 선택 칸 -->
            <div id="countri">
              <label for="text3-input"></label>
              <select id="country" name="country-input">
                <option value="">선택</option>
                <option value="한국">국내</option>
                <option value="해외">해외</option>
              </select>
            </div>
            <!-- 검색 버튼 칸 -->
            <div id="search">
              <button id="button" type="submit">영화 검색</button>
            </div>
          </form>
          <!-- 로딩 창 -->
          <div id="roading"></div>
        </div>

        <!-- 최신 영화 -->
        <div id="latest">
          <div id="latestmovie-title">
            <div id="latestmovie-title-name">이달의 영화</div>
          </div>
          <div id="movie1-box">
            <button class="btn-open-popup">
              <img id="movie1-poster" src="movieimg/movie1.png" />
            </button>
          </div>
          <div id="movie2-box">
            <button class="btn-open-popup">
              <img id="movie2-poster" src="movieimg/movie2.png" />
            </button>
          </div>
          <div id="movie3-box">
            <button class="btn-open-popup">
              <img id="movie3-poster" src="movieimg/movie3.png" />
            </button>
          </div>
          <div id="movie4-box">
            <button class="btn-open-popup">
              <img id="movie4-poster" src="movieimg/movie4.png" />
            </button>
          </div>
        </div>

        <!-- 베스트 영화 -->
        <div id="best-movie">
          <div id="bestmovie-title">
            <div id="bestmovie-title-name">베스트 영화</div>
          </div>
          <div id="movie1-box">
            <img id="movie1-poster" src="movieimg/bestmovie1.png" />
          </div>
          <div id="movie2-box">
            <img id="movie2-poster" src="movieimg/bestmovie2.png" />
          </div>
          <div id="movie3-box">
            <img id="movie3-poster" src="movieimg/bestmovie3.png" />
          </div>
          <div id="movie4-box">
            <img id="movie4-poster" src="movieimg/bestmovie4.png" />
          </div>
        </div>
        <!-- footer -->
        <footer>
          <nav>
            <a href="https://github.com/k2h2j3">Github</a>
          </nav>
          <p>
            <span>대표자 : 김승겸</span><br />
            <span>이메일 : k2h2j3@gmail.com</span><br />
            <span>MovieTracker 2023. Published</span>
          </p>
        </footer>
      </div>
    </div>

    <!-- JavaScript 파일 연결 -->
    <script>
      const modal = document.querySelector(".modal");
      const btnOpenPopup = document.querySelector(".btn-open-popup");

      btnOpenPopup.addEventListener("click", () => {
        modal.style.display = "block";
      });
      // 로딩버튼 처음에 가리기
      $("#loader").hide();
      let $button = document.querySelector("button");

      function combineText() {
        let qeustion;

        let year = document.getElementById("year").value;
        let genre = document.getElementById("genre").value;
        let country = document.querySelector("select").value;

        question =
          year +
          "년도의 장르가 " +
          genre +
          "인 " +
          country +
          "영화를 추천해 줘";

        return question;
      }

      let data = [
        {
          role: "system",
          content: "assistant는 영화 전문가이다.",
        },
      ];

      let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;

      $button.addEventListener("click", (e) => {
        $("#loader").show();
        e.preventDefault();
        userInputData = "";
        var quest = combineText();
        userInputData = quest;
        console.log(userInputData);
        quest = "";

        data.push({
          role: "user",
          content: userInputData,
        });

        chatGptAPI();
      });

      function chatGptAPI() {
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
          redirect: "follow",
        })
          .then((res) => res.json())
          .then((res) => {
            // console.log(res)
            // console.log(res.choices[0].message.content)
            document.querySelector("#contents").innerText =
              res.choices[0].message.content;
          });
      }
    </script>
  </body>
</html>
